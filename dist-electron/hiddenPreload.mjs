"use strict";const p=require("electron"),i={selectors:{postForm:"#new_post",accountNav:".pms-account-navigation",novelsSelect:"#cat"},urlKeywords:{post:"post",account:"account"},logPrefix:"[Hidden Preload]"};function d(t,o){p.ipcRenderer.send(t,o)}function e(t){d("console-log",`${i.logPrefix} ${t}`)}function v(){if(!document.querySelector(i.selectors.novelsSelect)){e("Novel select element not found");return}const o=w("cat","category");d("novels-data-hidden",o),e("Novels fetched:"+o.length)}async function h(t){e("Fetching volumes");try{const l=await(await fetch("https://kolnovel.com/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"volume_search",cat:t})})).text(),a=document.createElement("div");a.innerHTML=l;const n=Array.from(a.querySelectorAll("option")).slice(1).map(u=>({value:u.value,label:u.textContent||""}));d("novels-volumes-hidden",n),e(`Volumes fetched: ${n.length}`)}catch(o){e(`Error fetching volumes: ${o}`)}}function w(t,o){var m,g;const l=document.getElementById(t),a=document.getElementById(o);if(!l||!a)return console.error("One or both select elements not found."),[];const n=new Map;for(let c=0;c<l.options.length;c++){const r=l.options[c],s=(m=r.textContent)==null?void 0:m.toLowerCase();s&&!n.has(s)&&n.set(s,{values:new Set,text:r.textContent??"unknown"}),n.get(s).values.add(r.value)}const u=[];for(let c=0;c<a.options.length;c++){const r=a.options[c],s=(g=r.textContent)==null?void 0:g.toLowerCase();if(s&&n.has(s)){const f=n.get(s);f.values.add(r.value),u.push({value:Array.from(f.values).sort().join("-"),text:f.text}),n.delete(s)}}return u.sort((c,r)=>c.text.localeCompare(r.text)),u}function y(){return window.location.href.includes(i.urlKeywords.post)}function x(){return window.location.href.includes(i.urlKeywords.account)}function S(){e(`Checking for post form: ${i.selectors.postForm}`),document.querySelector(i.selectors.postForm)?(e("Post form found."),d("loged-in"),v()):(e("Post form not found. Sending 'form-missing' notification."),d("form-missing",i.selectors.postForm))}function C(){e("Checking for account navigation."),document.querySelector(i.selectors.accountNav)?(e("Account navigation found. Sending 'login-success' notification."),d("login-success")):e("Account navigation not found.")}function P(){var t;e("Script loaded."),window.addEventListener("DOMContentLoaded",()=>{e("DOM Content Loaded. Checking current page."),y()?S():x()?C():e("Current URL does not match any specific check.")}),(t=document.querySelector("#description-html"))==null||t.click(),p.ipcRenderer.on("novel-selected",(o,l)=>{e("novel-selected"),h(l)})}P();console.log("[Hidden Preload] Loaded.");
